{"ast":null,"code":"var events = require('events');\n\nvar inherits = require('inherits');\n\nmodule.exports = LRU;\n\nfunction LRU(opts) {\n  if (!(this instanceof LRU)) return new LRU(opts);\n  if (typeof opts === 'number') opts = {\n    max: opts\n  };\n  if (!opts) opts = {};\n  events.EventEmitter.call(this);\n  this.cache = {};\n  this.head = this.tail = null;\n  this.length = 0;\n  this.max = opts.max || 1000;\n  this.maxAge = opts.maxAge || 0;\n}\n\ninherits(LRU, events.EventEmitter);\nObject.defineProperty(LRU.prototype, 'keys', {\n  get: function () {\n    return Object.keys(this.cache);\n  }\n});\n\nLRU.prototype.clear = function () {\n  this.cache = {};\n  this.head = this.tail = null;\n  this.length = 0;\n};\n\nLRU.prototype.remove = function (key) {\n  if (typeof key !== 'string') key = '' + key;\n  if (!this.cache.hasOwnProperty(key)) return;\n  var element = this.cache[key];\n  delete this.cache[key];\n\n  this._unlink(key, element.prev, element.next);\n\n  return element.value;\n};\n\nLRU.prototype._unlink = function (key, prev, next) {\n  this.length--;\n\n  if (this.length === 0) {\n    this.head = this.tail = null;\n  } else {\n    if (this.head === key) {\n      this.head = prev;\n      this.cache[this.head].next = null;\n    } else if (this.tail === key) {\n      this.tail = next;\n      this.cache[this.tail].prev = null;\n    } else {\n      this.cache[prev].next = next;\n      this.cache[next].prev = prev;\n    }\n  }\n};\n\nLRU.prototype.peek = function (key) {\n  if (!this.cache.hasOwnProperty(key)) return;\n  var element = this.cache[key];\n  if (!this._checkAge(key, element)) return;\n  return element.value;\n};\n\nLRU.prototype.set = function (key, value) {\n  if (typeof key !== 'string') key = '' + key;\n  var element;\n\n  if (this.cache.hasOwnProperty(key)) {\n    element = this.cache[key];\n    element.value = value;\n    if (this.maxAge) element.modified = Date.now(); // If it's already the head, there's nothing more to do:\n\n    if (key === this.head) return value;\n\n    this._unlink(key, element.prev, element.next);\n  } else {\n    element = {\n      value: value,\n      modified: 0,\n      next: null,\n      prev: null\n    };\n    if (this.maxAge) element.modified = Date.now();\n    this.cache[key] = element; // Eviction is only possible if the key didn't already exist:\n\n    if (this.length === this.max) this.evict();\n  }\n\n  this.length++;\n  element.next = null;\n  element.prev = this.head;\n  if (this.head) this.cache[this.head].next = key;\n  this.head = key;\n  if (!this.tail) this.tail = key;\n  return value;\n};\n\nLRU.prototype._checkAge = function (key, element) {\n  if (this.maxAge && Date.now() - element.modified > this.maxAge) {\n    this.remove(key);\n    this.emit('evict', {\n      key: key,\n      value: element.value\n    });\n    return false;\n  }\n\n  return true;\n};\n\nLRU.prototype.get = function (key) {\n  if (typeof key !== 'string') key = '' + key;\n  if (!this.cache.hasOwnProperty(key)) return;\n  var element = this.cache[key];\n  if (!this._checkAge(key, element)) return;\n\n  if (this.head !== key) {\n    if (key === this.tail) {\n      this.tail = element.next;\n      this.cache[this.tail].prev = null;\n    } else {\n      // Set prev.next -> element.next:\n      this.cache[element.prev].next = element.next;\n    } // Set element.next.prev -> element.prev:\n\n\n    this.cache[element.next].prev = element.prev; // Element is the new head\n\n    this.cache[this.head].next = key;\n    element.prev = this.head;\n    element.next = null;\n    this.head = key;\n  }\n\n  return element.value;\n};\n\nLRU.prototype.evict = function () {\n  if (!this.tail) return;\n  var key = this.tail;\n  var value = this.remove(this.tail);\n  this.emit('evict', {\n    key: key,\n    value: value\n  });\n};","map":{"version":3,"sources":["/home/user/orbit-playground/music-app/node_modules/lru/index.js"],"names":["events","require","inherits","module","exports","LRU","opts","max","EventEmitter","call","cache","head","tail","length","maxAge","Object","defineProperty","prototype","get","keys","clear","remove","key","hasOwnProperty","element","_unlink","prev","next","value","peek","_checkAge","set","modified","Date","now","evict","emit"],"mappings":"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","sourcesContent":["var events = require('events')\nvar inherits = require('inherits')\n\nmodule.exports = LRU\n\nfunction LRU (opts) {\n  if (!(this instanceof LRU)) return new LRU(opts)\n  if (typeof opts === 'number') opts = {max: opts}\n  if (!opts) opts = {}\n  events.EventEmitter.call(this)\n  this.cache = {}\n  this.head = this.tail = null\n  this.length = 0\n  this.max = opts.max || 1000\n  this.maxAge = opts.maxAge || 0\n}\n\ninherits(LRU, events.EventEmitter)\n\nObject.defineProperty(LRU.prototype, 'keys', {\n  get: function () { return Object.keys(this.cache) }\n})\n\nLRU.prototype.clear = function () {\n  this.cache = {}\n  this.head = this.tail = null\n  this.length = 0\n}\n\nLRU.prototype.remove = function (key) {\n  if (typeof key !== 'string') key = '' + key\n  if (!this.cache.hasOwnProperty(key)) return\n\n  var element = this.cache[key]\n  delete this.cache[key]\n  this._unlink(key, element.prev, element.next)\n  return element.value\n}\n\nLRU.prototype._unlink = function (key, prev, next) {\n  this.length--\n\n  if (this.length === 0) {\n    this.head = this.tail = null\n  } else {\n    if (this.head === key) {\n      this.head = prev\n      this.cache[this.head].next = null\n    } else if (this.tail === key) {\n      this.tail = next\n      this.cache[this.tail].prev = null\n    } else {\n      this.cache[prev].next = next\n      this.cache[next].prev = prev\n    }\n  }\n}\n\nLRU.prototype.peek = function (key) {\n  if (!this.cache.hasOwnProperty(key)) return\n\n  var element = this.cache[key]\n\n  if (!this._checkAge(key, element)) return\n  return element.value\n}\n\nLRU.prototype.set = function (key, value) {\n  if (typeof key !== 'string') key = '' + key\n\n  var element\n\n  if (this.cache.hasOwnProperty(key)) {\n    element = this.cache[key]\n    element.value = value\n    if (this.maxAge) element.modified = Date.now()\n\n    // If it's already the head, there's nothing more to do:\n    if (key === this.head) return value\n    this._unlink(key, element.prev, element.next)\n  } else {\n    element = {value: value, modified: 0, next: null, prev: null}\n    if (this.maxAge) element.modified = Date.now()\n    this.cache[key] = element\n\n    // Eviction is only possible if the key didn't already exist:\n    if (this.length === this.max) this.evict()\n  }\n\n  this.length++\n  element.next = null\n  element.prev = this.head\n\n  if (this.head) this.cache[this.head].next = key\n  this.head = key\n\n  if (!this.tail) this.tail = key\n  return value\n}\n\nLRU.prototype._checkAge = function (key, element) {\n  if (this.maxAge && (Date.now() - element.modified) > this.maxAge) {\n    this.remove(key)\n    this.emit('evict', {key: key, value: element.value})\n    return false\n  }\n  return true\n}\n\nLRU.prototype.get = function (key) {\n  if (typeof key !== 'string') key = '' + key\n  if (!this.cache.hasOwnProperty(key)) return\n\n  var element = this.cache[key]\n\n  if (!this._checkAge(key, element)) return\n\n  if (this.head !== key) {\n    if (key === this.tail) {\n      this.tail = element.next\n      this.cache[this.tail].prev = null\n    } else {\n      // Set prev.next -> element.next:\n      this.cache[element.prev].next = element.next\n    }\n\n    // Set element.next.prev -> element.prev:\n    this.cache[element.next].prev = element.prev\n\n    // Element is the new head\n    this.cache[this.head].next = key\n    element.prev = this.head\n    element.next = null\n    this.head = key\n  }\n\n  return element.value\n}\n\nLRU.prototype.evict = function () {\n  if (!this.tail) return\n  var key = this.tail\n  var value = this.remove(this.tail)\n  this.emit('evict', {key: key, value: value})\n}\n"]},"metadata":{},"sourceType":"script"}