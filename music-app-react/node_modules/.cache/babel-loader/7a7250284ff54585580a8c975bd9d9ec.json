{"ast":null,"code":"'use strict';\n\nconst batch = require('it-batch');\n/**\n * @template T\n * @typedef {function():Promise<T>} Task\n */\n\n/**\n * Takes an (async) iterator that emits promise-returning functions,\n * invokes them in parallel and emits the results as they become available but\n * in the same order as the input\n *\n * @template T\n * @param {AsyncIterable<Task<T>>} source\n * @param {number|string} [size=1]\n * @returns {AsyncIterable<T>}\n */\n\n\nasync function* parallelBatch(source, size) {\n  // @ts-ignore - expects string not a number\n  size = parseInt(size);\n\n  if (isNaN(size) || size < 1) {\n    size = 1;\n  }\n\n  for await (const tasks of batch(source, size)) {\n    /** @type {Promise<{ok:true, value:T}|{ok:false, err:Error}>[]} */\n    const things = tasks.map(p => {\n      return p().then(value => ({\n        ok: true,\n        value\n      }), err => ({\n        ok: false,\n        err\n      }));\n    });\n\n    for (let i = 0; i < things.length; i++) {\n      const result = await things[i];\n\n      if (result.ok) {\n        yield result.value;\n      } else {\n        throw result.err;\n      }\n    }\n  }\n}\n\nmodule.exports = parallelBatch;","map":{"version":3,"sources":["/home/user/orbit-playground/music-app/node_modules/it-parallel-batch/index.js"],"names":["batch","require","parallelBatch","source","size","parseInt","isNaN","tasks","things","map","p","then","value","ok","err","i","length","result","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,UAAD,CAArB;AAEA;;;;;AAKA;;;;;;;;;;;;AAUA,gBAAiBC,aAAjB,CAAgCC,MAAhC,EAAwCC,IAAxC,EAA8C;AAC5C;AACAA,EAAAA,IAAI,GAAGC,QAAQ,CAACD,IAAD,CAAf;;AAEA,MAAIE,KAAK,CAACF,IAAD,CAAL,IAAeA,IAAI,GAAG,CAA1B,EAA6B;AAC3BA,IAAAA,IAAI,GAAG,CAAP;AACD;;AAED,aAAW,MAAMG,KAAjB,IAA0BP,KAAK,CAACG,MAAD,EAASC,IAAT,CAA/B,EAA+C;AAC7C;AACA,UAAMI,MAAM,GAAGD,KAAK,CAACE,GAAN,CAAUC,CAAC,IAAI;AAC5B,aAAOA,CAAC,GAAGC,IAAJ,CAASC,KAAK,KAAK;AAAEC,QAAAA,EAAE,EAAE,IAAN;AAAYD,QAAAA;AAAZ,OAAL,CAAd,EAAyCE,GAAG,KAAK;AAAED,QAAAA,EAAE,EAAE,KAAN;AAAaC,QAAAA;AAAb,OAAL,CAA5C,CAAP;AACD,KAFc,CAAf;;AAIA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,MAAM,CAACQ,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACtC,YAAME,MAAM,GAAG,MAAMT,MAAM,CAACO,CAAD,CAA3B;;AAEA,UAAIE,MAAM,CAACJ,EAAX,EAAe;AACb,cAAMI,MAAM,CAACL,KAAb;AACD,OAFD,MAEO;AACL,cAAMK,MAAM,CAACH,GAAb;AACD;AACF;AACF;AACF;;AAEDI,MAAM,CAACC,OAAP,GAAiBjB,aAAjB","sourcesContent":["'use strict'\n\nconst batch = require('it-batch')\n\n/**\n * @template T\n * @typedef {function():Promise<T>} Task\n */\n\n/**\n * Takes an (async) iterator that emits promise-returning functions,\n * invokes them in parallel and emits the results as they become available but\n * in the same order as the input\n *\n * @template T\n * @param {AsyncIterable<Task<T>>} source\n * @param {number|string} [size=1]\n * @returns {AsyncIterable<T>}\n */\nasync function * parallelBatch (source, size) {\n  // @ts-ignore - expects string not a number\n  size = parseInt(size)\n\n  if (isNaN(size) || size < 1) {\n    size = 1\n  }\n\n  for await (const tasks of batch(source, size)) {\n    /** @type {Promise<{ok:true, value:T}|{ok:false, err:Error}>[]} */\n    const things = tasks.map(p => {\n      return p().then(value => ({ ok: true, value }), err => ({ ok: false, err }))\n    })\n\n    for (let i = 0; i < things.length; i++) {\n      const result = await things[i]\n\n      if (result.ok) {\n        yield result.value\n      } else {\n        throw result.err\n      }\n    }\n  }\n}\n\nmodule.exports = parallelBatch\n"]},"metadata":{},"sourceType":"script"}