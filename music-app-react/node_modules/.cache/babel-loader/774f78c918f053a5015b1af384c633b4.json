{"ast":null,"code":"'use strict';\n\nconst defer = require('p-defer');\n\nconst {\n  NotStartedError,\n  AlreadyInitializedError\n} = require('../errors');\n\nconst Components = require('./');\n\nconst {\n  withTimeoutOption\n} = require('../utils');\n\nmodule.exports = ({\n  apiManager,\n  options: constructorOptions,\n  bitswap,\n  blockService,\n  gcLock,\n  initOptions,\n  ipld,\n  ipns,\n  keychain,\n  libp2p,\n  mfsPreload,\n  peerId,\n  pinManager = {},\n  preload,\n  print,\n  repo\n}) => withTimeoutOption(async function stop() {\n  const stopPromise = defer();\n  const {\n    cancel\n  } = apiManager.update({\n    stop: () => stopPromise.promise\n  });\n\n  try {\n    blockService.unsetExchange();\n    bitswap.stop();\n    preload.stop();\n    await Promise.all([ipns.republisher.stop(), mfsPreload.stop(), libp2p.stop(), repo.close()]);\n    const api = createApi({\n      apiManager,\n      constructorOptions,\n      blockService,\n      gcLock,\n      initOptions,\n      ipld,\n      keychain,\n      peerId,\n      pinManager,\n      preload,\n      print,\n      repo\n    });\n    apiManager.update(api, () => {\n      throw new NotStartedError();\n    });\n  } catch (err) {\n    cancel();\n    stopPromise.reject(err);\n    throw err;\n  }\n\n  stopPromise.resolve();\n});\n\nfunction createApi({\n  apiManager,\n  constructorOptions,\n  blockService,\n  gcLock,\n  initOptions,\n  ipld,\n  keychain,\n  peerId,\n  pinManager,\n  preload,\n  print,\n  repo\n}) {\n  const dag = {\n    get: Components.dag.get({\n      ipld,\n      preload\n    }),\n    resolve: Components.dag.resolve({\n      ipld,\n      preload\n    }),\n    tree: Components.dag.tree({\n      ipld,\n      preload\n    })\n  };\n  const object = {\n    data: Components.object.data({\n      ipld,\n      preload\n    }),\n    get: Components.object.get({\n      ipld,\n      preload\n    }),\n    links: Components.object.links({\n      dag\n    }),\n    new: Components.object.new({\n      ipld,\n      preload\n    }),\n    patch: {\n      addLink: Components.object.patch.addLink({\n        ipld,\n        gcLock,\n        preload\n      }),\n      appendData: Components.object.patch.appendData({\n        ipld,\n        gcLock,\n        preload\n      }),\n      rmLink: Components.object.patch.rmLink({\n        ipld,\n        gcLock,\n        preload\n      }),\n      setData: Components.object.patch.setData({\n        ipld,\n        gcLock,\n        preload\n      })\n    },\n    put: Components.object.put({\n      ipld,\n      gcLock,\n      preload\n    }),\n    stat: Components.object.stat({\n      ipld,\n      preload\n    })\n  };\n  const pinAddAll = Components.pin.addAll({\n    pinManager,\n    gcLock,\n    dag\n  });\n  const pinRmAll = Components.pin.rmAll({\n    pinManager,\n    gcLock,\n    dag\n  });\n  const pin = {\n    add: Components.pin.add({\n      addAll: pinAddAll\n    }),\n    addAll: pinAddAll,\n    ls: Components.pin.ls({\n      pinManager,\n      dag\n    }),\n    rm: Components.pin.rm({\n      rmAll: pinRmAll\n    }),\n    rmAll: pinRmAll\n  }; // FIXME: resolve this circular dependency\n\n  dag.put = Components.dag.put({\n    ipld,\n    pin,\n    gcLock,\n    preload\n  });\n  const block = {\n    get: Components.block.get({\n      blockService,\n      preload\n    }),\n    put: Components.block.put({\n      blockService,\n      pin,\n      gcLock,\n      preload\n    }),\n    rm: Components.block.rm({\n      blockService,\n      gcLock,\n      pinManager\n    }),\n    stat: Components.block.stat({\n      blockService,\n      preload\n    })\n  };\n  const addAll = Components.addAll({\n    block,\n    preload,\n    pin,\n    gcLock,\n    options: constructorOptions\n  });\n  const resolve = Components.resolve({\n    ipld\n  });\n  const refs = Object.assign(Components.refs({\n    ipld,\n    resolve,\n    preload\n  }), {\n    local: Components.refs.local({\n      repo\n    })\n  });\n\n  const notStarted = async () => {\n    // eslint-disable-line require-await\n    throw new NotStartedError();\n  };\n\n  const api = {\n    add: Components.add({\n      addAll\n    }),\n    addAll,\n    bitswap: {\n      stat: notStarted,\n      unwant: notStarted,\n      wantlist: notStarted,\n      wantlistForPeer: notStarted\n    },\n    block,\n    bootstrap: {\n      add: Components.bootstrap.add({\n        repo\n      }),\n      clear: Components.bootstrap.clear({\n        repo\n      }),\n      list: Components.bootstrap.list({\n        repo\n      }),\n      reset: Components.bootstrap.reset({\n        repo\n      }),\n      rm: Components.bootstrap.rm({\n        repo\n      })\n    },\n    cat: Components.cat({\n      ipld,\n      preload\n    }),\n    config: Components.config({\n      repo\n    }),\n    dag,\n    dns: Components.dns(),\n    files: Components.files({\n      ipld,\n      block,\n      blockService,\n      repo,\n      preload,\n      options: constructorOptions\n    }),\n    get: Components.get({\n      ipld,\n      preload\n    }),\n    id: Components.id({\n      peerId\n    }),\n    init: async () => {\n      // eslint-disable-line require-await\n      throw new AlreadyInitializedError();\n    },\n    isOnline: Components.isOnline({}),\n    key: {\n      export: Components.key.export({\n        keychain\n      }),\n      gen: Components.key.gen({\n        keychain\n      }),\n      import: Components.key.import({\n        keychain\n      }),\n      info: Components.key.info({\n        keychain\n      }),\n      list: Components.key.list({\n        keychain\n      }),\n      rename: Components.key.rename({\n        keychain\n      }),\n      rm: Components.key.rm({\n        keychain\n      })\n    },\n    ls: Components.ls({\n      ipld,\n      preload\n    }),\n    object,\n    pin,\n    refs,\n    repo: {\n      gc: Components.repo.gc({\n        gcLock,\n        pin,\n        pinManager,\n        refs,\n        repo\n      }),\n      stat: Components.repo.stat({\n        repo\n      }),\n      version: Components.repo.version({\n        repo\n      })\n    },\n    resolve,\n    start: Components.start({\n      apiManager,\n      options: constructorOptions,\n      blockService,\n      gcLock,\n      initOptions,\n      ipld,\n      keychain,\n      peerId,\n      pinManager,\n      preload,\n      print,\n      repo\n    }),\n    stats: {\n      bitswap: notStarted,\n      bw: notStarted,\n      repo: Components.repo.stat({\n        repo\n      })\n    },\n    stop: () => {},\n    swarm: {\n      addrs: notStarted,\n      connect: notStarted,\n      disconnect: notStarted,\n      localAddrs: Components.swarm.localAddrs({\n        multiaddrs: []\n      }),\n      peers: notStarted\n    },\n    version: Components.version({\n      repo\n    })\n  };\n  return api;\n}","map":{"version":3,"sources":["/home/user/orbit-playground/music-app/node_modules/ipfs/src/core/components/stop.js"],"names":["defer","require","NotStartedError","AlreadyInitializedError","Components","withTimeoutOption","module","exports","apiManager","options","constructorOptions","bitswap","blockService","gcLock","initOptions","ipld","ipns","keychain","libp2p","mfsPreload","peerId","pinManager","preload","print","repo","stop","stopPromise","cancel","update","promise","unsetExchange","Promise","all","republisher","close","api","createApi","err","reject","resolve","dag","get","tree","object","data","links","new","patch","addLink","appendData","rmLink","setData","put","stat","pinAddAll","pin","addAll","pinRmAll","rmAll","add","ls","rm","block","refs","Object","assign","local","notStarted","unwant","wantlist","wantlistForPeer","bootstrap","clear","list","reset","cat","config","dns","files","id","init","isOnline","key","export","gen","import","info","rename","gc","version","start","stats","bw","swarm","addrs","connect","disconnect","localAddrs","multiaddrs","peers"],"mappings":"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","sourcesContent":["'use strict'\n\nconst defer = require('p-defer')\nconst { NotStartedError, AlreadyInitializedError } = require('../errors')\nconst Components = require('./')\nconst { withTimeoutOption } = require('../utils')\n\nmodule.exports = ({\n  apiManager,\n  options: constructorOptions,\n  bitswap,\n  blockService,\n  gcLock,\n  initOptions,\n  ipld,\n  ipns,\n  keychain,\n  libp2p,\n  mfsPreload,\n  peerId,\n  pinManager = {},\n  preload,\n  print,\n  repo\n}) => withTimeoutOption(async function stop () {\n  const stopPromise = defer()\n  const { cancel } = apiManager.update({ stop: () => stopPromise.promise })\n\n  try {\n    blockService.unsetExchange()\n    bitswap.stop()\n    preload.stop()\n\n    await Promise.all([\n      ipns.republisher.stop(),\n      mfsPreload.stop(),\n      libp2p.stop(),\n      repo.close()\n    ])\n\n    const api = createApi({\n      apiManager,\n      constructorOptions,\n      blockService,\n      gcLock,\n      initOptions,\n      ipld,\n      keychain,\n      peerId,\n      pinManager,\n      preload,\n      print,\n      repo\n    })\n\n    apiManager.update(api, () => { throw new NotStartedError() })\n  } catch (err) {\n    cancel()\n    stopPromise.reject(err)\n    throw err\n  }\n\n  stopPromise.resolve()\n})\n\nfunction createApi ({\n  apiManager,\n  constructorOptions,\n  blockService,\n  gcLock,\n  initOptions,\n  ipld,\n  keychain,\n  peerId,\n  pinManager,\n  preload,\n  print,\n  repo\n}) {\n  const dag = {\n    get: Components.dag.get({ ipld, preload }),\n    resolve: Components.dag.resolve({ ipld, preload }),\n    tree: Components.dag.tree({ ipld, preload })\n  }\n  const object = {\n    data: Components.object.data({ ipld, preload }),\n    get: Components.object.get({ ipld, preload }),\n    links: Components.object.links({ dag }),\n    new: Components.object.new({ ipld, preload }),\n    patch: {\n      addLink: Components.object.patch.addLink({ ipld, gcLock, preload }),\n      appendData: Components.object.patch.appendData({ ipld, gcLock, preload }),\n      rmLink: Components.object.patch.rmLink({ ipld, gcLock, preload }),\n      setData: Components.object.patch.setData({ ipld, gcLock, preload })\n    },\n    put: Components.object.put({ ipld, gcLock, preload }),\n    stat: Components.object.stat({ ipld, preload })\n  }\n\n  const pinAddAll = Components.pin.addAll({ pinManager, gcLock, dag })\n  const pinRmAll = Components.pin.rmAll({ pinManager, gcLock, dag })\n\n  const pin = {\n    add: Components.pin.add({ addAll: pinAddAll }),\n    addAll: pinAddAll,\n    ls: Components.pin.ls({ pinManager, dag }),\n    rm: Components.pin.rm({ rmAll: pinRmAll }),\n    rmAll: pinRmAll\n  }\n\n  // FIXME: resolve this circular dependency\n  dag.put = Components.dag.put({ ipld, pin, gcLock, preload })\n\n  const block = {\n    get: Components.block.get({ blockService, preload }),\n    put: Components.block.put({ blockService, pin, gcLock, preload }),\n    rm: Components.block.rm({ blockService, gcLock, pinManager }),\n    stat: Components.block.stat({ blockService, preload })\n  }\n\n  const addAll = Components.addAll({ block, preload, pin, gcLock, options: constructorOptions })\n  const resolve = Components.resolve({ ipld })\n  const refs = Object.assign(\n    Components.refs({ ipld, resolve, preload }),\n    { local: Components.refs.local({ repo }) }\n  )\n\n  const notStarted = async () => { // eslint-disable-line require-await\n    throw new NotStartedError()\n  }\n\n  const api = {\n    add: Components.add({ addAll }),\n    addAll,\n    bitswap: {\n      stat: notStarted,\n      unwant: notStarted,\n      wantlist: notStarted,\n      wantlistForPeer: notStarted\n    },\n    block,\n    bootstrap: {\n      add: Components.bootstrap.add({ repo }),\n      clear: Components.bootstrap.clear({ repo }),\n      list: Components.bootstrap.list({ repo }),\n      reset: Components.bootstrap.reset({ repo }),\n      rm: Components.bootstrap.rm({ repo })\n    },\n    cat: Components.cat({ ipld, preload }),\n    config: Components.config({ repo }),\n    dag,\n    dns: Components.dns(),\n    files: Components.files({ ipld, block, blockService, repo, preload, options: constructorOptions }),\n    get: Components.get({ ipld, preload }),\n    id: Components.id({ peerId }),\n    init: async () => { // eslint-disable-line require-await\n      throw new AlreadyInitializedError()\n    },\n    isOnline: Components.isOnline({}),\n    key: {\n      export: Components.key.export({ keychain }),\n      gen: Components.key.gen({ keychain }),\n      import: Components.key.import({ keychain }),\n      info: Components.key.info({ keychain }),\n      list: Components.key.list({ keychain }),\n      rename: Components.key.rename({ keychain }),\n      rm: Components.key.rm({ keychain })\n    },\n    ls: Components.ls({ ipld, preload }),\n    object,\n    pin,\n    refs,\n    repo: {\n      gc: Components.repo.gc({ gcLock, pin, pinManager, refs, repo }),\n      stat: Components.repo.stat({ repo }),\n      version: Components.repo.version({ repo })\n    },\n    resolve,\n    start: Components.start({\n      apiManager,\n      options: constructorOptions,\n      blockService,\n      gcLock,\n      initOptions,\n      ipld,\n      keychain,\n      peerId,\n      pinManager,\n      preload,\n      print,\n      repo\n    }),\n    stats: {\n      bitswap: notStarted,\n      bw: notStarted,\n      repo: Components.repo.stat({ repo })\n    },\n    stop: () => {},\n    swarm: {\n      addrs: notStarted,\n      connect: notStarted,\n      disconnect: notStarted,\n      localAddrs: Components.swarm.localAddrs({ multiaddrs: [] }),\n      peers: notStarted\n    },\n    version: Components.version({ repo })\n  }\n\n  return api\n}\n"]},"metadata":{},"sourceType":"script"}