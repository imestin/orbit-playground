{"ast":null,"code":"'use strict';\n\nclass DocumentIndex {\n  constructor() {\n    this._index = {};\n  }\n\n  get(key, fullOp = false) {\n    return fullOp ? this._index[key] : this._index[key] ? this._index[key].payload.value : null;\n  }\n\n  updateIndex(oplog, onProgressCallback) {\n    const reducer = (handled, item, idx) => {\n      if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n        for (const doc of item.payload.docs) {\n          if (doc && handled[doc.key] !== true) {\n            handled[doc.key] = true;\n            this._index[doc.key] = {\n              payload: {\n                op: 'PUT',\n                key: doc.key,\n                value: doc.value\n              }\n            };\n          }\n        }\n      } else if (handled[item.payload.key] !== true) {\n        handled[item.payload.key] = true;\n\n        if (item.payload.op === 'PUT') {\n          this._index[item.payload.key] = item;\n        } else if (item.payload.op === 'DEL') {\n          delete this._index[item.payload.key];\n        }\n      }\n\n      if (onProgressCallback) onProgressCallback(item, idx);\n      return handled;\n    };\n\n    oplog.values.slice().reverse().reduce(reducer, {});\n  }\n\n}\n\nmodule.exports = DocumentIndex;","map":{"version":3,"sources":["/home/user/orbit-playground/music-app-react/node_modules/orbit-db-docstore/src/DocumentIndex.js"],"names":["DocumentIndex","constructor","_index","get","key","fullOp","payload","value","updateIndex","oplog","onProgressCallback","reducer","handled","item","idx","op","docs","Symbol","iterator","doc","values","slice","reverse","reduce","module","exports"],"mappings":"AAAA;;AAEA,MAAMA,aAAN,CAAoB;AAClBC,EAAAA,WAAW,GAAI;AACb,SAAKC,MAAL,GAAc,EAAd;AACD;;AAEDC,EAAAA,GAAG,CAAEC,GAAF,EAAOC,MAAM,GAAG,KAAhB,EAAuB;AACxB,WAAOA,MAAM,GACT,KAAKH,MAAL,CAAYE,GAAZ,CADS,GAET,KAAKF,MAAL,CAAYE,GAAZ,IAAmB,KAAKF,MAAL,CAAYE,GAAZ,EAAiBE,OAAjB,CAAyBC,KAA5C,GAAoD,IAFxD;AAGD;;AAEDC,EAAAA,WAAW,CAAEC,KAAF,EAASC,kBAAT,EAA6B;AACtC,UAAMC,OAAO,GAAG,CAACC,OAAD,EAAUC,IAAV,EAAgBC,GAAhB,KAAwB;AACtC,UAAID,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,QAApB,IAAgCF,IAAI,CAACP,OAAL,CAAaU,IAAb,CAAkBC,MAAM,CAACC,QAAzB,CAApC,EAAwE;AACtE,aAAK,MAAMC,GAAX,IAAkBN,IAAI,CAACP,OAAL,CAAaU,IAA/B,EAAqC;AACnC,cAAIG,GAAG,IAAIP,OAAO,CAACO,GAAG,CAACf,GAAL,CAAP,KAAqB,IAAhC,EAAsC;AACpCQ,YAAAA,OAAO,CAACO,GAAG,CAACf,GAAL,CAAP,GAAmB,IAAnB;AACA,iBAAKF,MAAL,CAAYiB,GAAG,CAACf,GAAhB,IAAuB;AACrBE,cAAAA,OAAO,EAAE;AACPS,gBAAAA,EAAE,EAAE,KADG;AAEPX,gBAAAA,GAAG,EAAEe,GAAG,CAACf,GAFF;AAGPG,gBAAAA,KAAK,EAAEY,GAAG,CAACZ;AAHJ;AADY,aAAvB;AAOD;AACF;AACF,OAbD,MAaO,IAAIK,OAAO,CAACC,IAAI,CAACP,OAAL,CAAaF,GAAd,CAAP,KAA8B,IAAlC,EAAwC;AAC7CQ,QAAAA,OAAO,CAACC,IAAI,CAACP,OAAL,CAAaF,GAAd,CAAP,GAA4B,IAA5B;;AACA,YAAIS,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,KAAxB,EAA+B;AAC7B,eAAKb,MAAL,CAAYW,IAAI,CAACP,OAAL,CAAaF,GAAzB,IAAgCS,IAAhC;AACD,SAFD,MAEO,IAAIA,IAAI,CAACP,OAAL,CAAaS,EAAb,KAAoB,KAAxB,EAA+B;AACpC,iBAAO,KAAKb,MAAL,CAAYW,IAAI,CAACP,OAAL,CAAaF,GAAzB,CAAP;AACD;AACF;;AACD,UAAIM,kBAAJ,EAAwBA,kBAAkB,CAACG,IAAD,EAAOC,GAAP,CAAlB;AACxB,aAAOF,OAAP;AACD,KAxBD;;AA0BAH,IAAAA,KAAK,CAACW,MAAN,CACGC,KADH,GAEGC,OAFH,GAGGC,MAHH,CAGUZ,OAHV,EAGmB,EAHnB;AAID;;AA1CiB;;AA6CpBa,MAAM,CAACC,OAAP,GAAiBzB,aAAjB","sourcesContent":["'use strict'\n\nclass DocumentIndex {\n  constructor () {\n    this._index = {}\n  }\n\n  get (key, fullOp = false) {\n    return fullOp\n      ? this._index[key]\n      : this._index[key] ? this._index[key].payload.value : null\n  }\n\n  updateIndex (oplog, onProgressCallback) {\n    const reducer = (handled, item, idx) => {\n      if (item.payload.op === 'PUTALL' && item.payload.docs[Symbol.iterator]) {\n        for (const doc of item.payload.docs) {\n          if (doc && handled[doc.key] !== true) {\n            handled[doc.key] = true\n            this._index[doc.key] = {\n              payload: {\n                op: 'PUT',\n                key: doc.key,\n                value: doc.value\n              }\n            }\n          }\n        }\n      } else if (handled[item.payload.key] !== true) {\n        handled[item.payload.key] = true\n        if (item.payload.op === 'PUT') {\n          this._index[item.payload.key] = item\n        } else if (item.payload.op === 'DEL') {\n          delete this._index[item.payload.key]\n        }\n      }\n      if (onProgressCallback) onProgressCallback(item, idx)\n      return handled\n    }\n\n    oplog.values\n      .slice()\n      .reverse()\n      .reduce(reducer, {})\n  }\n}\n\nmodule.exports = DocumentIndex\n"]},"metadata":{},"sourceType":"script"}