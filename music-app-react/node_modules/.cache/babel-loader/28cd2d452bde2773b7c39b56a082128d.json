{"ast":null,"code":"'use strict';\n\nconst uint8ArrayEquals = require('uint8arrays/equals');\n\nconst Message = require('../../message');\n\nconst utils = require('../../utils');\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerId, 'rpc:find-node');\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   * @returns {Promise<Message>}\n   */\n\n  return async function findNode(peerId, msg) {\n    log('start');\n    let closer;\n\n    if (uint8ArrayEquals(msg.key, dht.peerId.id)) {\n      closer = [{\n        id: dht.peerId\n      }];\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peerId);\n    }\n\n    const response = new Message(msg.type, new Uint8Array(0), msg.clusterLevel);\n\n    if (closer.length > 0) {\n      response.closerPeers = closer;\n    } else {\n      log('handle FindNode %s: could not find anything', peerId.toB58String());\n    }\n\n    return response;\n  };\n};","map":{"version":3,"sources":["/home/user/orbit-playground/music-app/node_modules/libp2p-kad-dht/src/rpc/handlers/find-node.js"],"names":["uint8ArrayEquals","require","Message","utils","module","exports","dht","log","logger","peerId","findNode","msg","closer","key","id","_betterPeersToQuery","response","type","Uint8Array","clusterLevel","length","closerPeers","toB58String"],"mappings":"AAAA;;AAEA,MAAMA,gBAAgB,GAAGC,OAAO,CAAC,oBAAD,CAAhC;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,eAAD,CAAvB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,aAAD,CAArB;;AAEAG,MAAM,CAACC,OAAP,GAAkBC,GAAD,IAAS;AACxB,QAAMC,GAAG,GAAGJ,KAAK,CAACK,MAAN,CAAaF,GAAG,CAACG,MAAjB,EAAyB,eAAzB,CAAZ;AAEA;;;;;;;;AAOA,SAAO,eAAeC,QAAf,CAAyBD,MAAzB,EAAiCE,GAAjC,EAAsC;AAC3CJ,IAAAA,GAAG,CAAC,OAAD,CAAH;AAEA,QAAIK,MAAJ;;AACA,QAAIZ,gBAAgB,CAACW,GAAG,CAACE,GAAL,EAAUP,GAAG,CAACG,MAAJ,CAAWK,EAArB,CAApB,EAA8C;AAC5CF,MAAAA,MAAM,GAAG,CAAC;AACRE,QAAAA,EAAE,EAAER,GAAG,CAACG;AADA,OAAD,CAAT;AAGD,KAJD,MAIO;AACLG,MAAAA,MAAM,GAAG,MAAMN,GAAG,CAACS,mBAAJ,CAAwBJ,GAAxB,EAA6BF,MAA7B,CAAf;AACD;;AAED,UAAMO,QAAQ,GAAG,IAAId,OAAJ,CAAYS,GAAG,CAACM,IAAhB,EAAsB,IAAIC,UAAJ,CAAe,CAAf,CAAtB,EAAyCP,GAAG,CAACQ,YAA7C,CAAjB;;AAEA,QAAIP,MAAM,CAACQ,MAAP,GAAgB,CAApB,EAAuB;AACrBJ,MAAAA,QAAQ,CAACK,WAAT,GAAuBT,MAAvB;AACD,KAFD,MAEO;AACLL,MAAAA,GAAG,CAAC,6CAAD,EAAgDE,MAAM,CAACa,WAAP,EAAhD,CAAH;AACD;;AAED,WAAON,QAAP;AACD,GArBD;AAsBD,CAhCD","sourcesContent":["'use strict'\n\nconst uint8ArrayEquals = require('uint8arrays/equals')\nconst Message = require('../../message')\nconst utils = require('../../utils')\n\nmodule.exports = (dht) => {\n  const log = utils.logger(dht.peerId, 'rpc:find-node')\n\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   * @returns {Promise<Message>}\n   */\n  return async function findNode (peerId, msg) {\n    log('start')\n\n    let closer\n    if (uint8ArrayEquals(msg.key, dht.peerId.id)) {\n      closer = [{\n        id: dht.peerId\n      }]\n    } else {\n      closer = await dht._betterPeersToQuery(msg, peerId)\n    }\n\n    const response = new Message(msg.type, new Uint8Array(0), msg.clusterLevel)\n\n    if (closer.length > 0) {\n      response.closerPeers = closer\n    } else {\n      log('handle FindNode %s: could not find anything', peerId.toB58String())\n    }\n\n    return response\n  }\n}\n"]},"metadata":{},"sourceType":"script"}