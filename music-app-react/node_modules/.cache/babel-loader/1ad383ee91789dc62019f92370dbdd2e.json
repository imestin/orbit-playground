{"ast":null,"code":"'use strict';\n\nconst Key = require('interface-datastore').Key;\n\nconst debug = require('debug');\n\nconst log = debug('ipfs:repo:version');\n\nconst uint8ArrayToString = require('uint8arrays/to-string');\n\nconst uint8ArrayFromString = require('uint8arrays/from-string');\n\nconst versionKey = new Key('version');\n\nmodule.exports = store => {\n  return {\n    /**\n     * Check if a version file exists.\n     *\n     * @returns {Promise<bool>}\n     */\n    async exists() {\n      // eslint-disable-line require-await\n      return store.has(versionKey);\n    },\n\n    /**\n     * Get the current version.\n     *\n     * @returns {Promise<Integer>}\n     */\n    async get() {\n      const buf = await store.get(versionKey);\n      return parseInt(uint8ArrayToString(buf), 10);\n    },\n\n    /**\n     * Set the version of the repo, writing it to the underlying store.\n     *\n     * @param {number} version\n     * @returns {Promise<void>}\n     */\n    async set(version) {\n      // eslint-disable-line require-await\n      return store.put(versionKey, uint8ArrayFromString(String(version)));\n    },\n\n    /**\n     * Check the current version, and returns true if versions matches\n     * @param {number} expected\n     * @returns {boolean}\n     */\n    async check(expected) {\n      const version = await this.get();\n      log('comparing version: %s and %s', version, expected); // Version 6 and 7 are the same\n      // TODO: Clean up the compatibility logic. Repo feature detection would be ideal, or a better version schema\n\n      const compatibleVersion = version === 6 && expected === 7 || expected === 6 && version === 7;\n      return version === expected || compatibleVersion;\n    }\n\n  };\n};","map":{"version":3,"sources":["/home/user/orbit-playground/music-app/node_modules/ipfs-repo/src/version.js"],"names":["Key","require","debug","log","uint8ArrayToString","uint8ArrayFromString","versionKey","module","exports","store","exists","has","get","buf","parseInt","set","version","put","String","check","expected","compatibleVersion"],"mappings":"AAAA;;AAEA,MAAMA,GAAG,GAAGC,OAAO,CAAC,qBAAD,CAAP,CAA+BD,GAA3C;;AACA,MAAME,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AACA,MAAME,GAAG,GAAGD,KAAK,CAAC,mBAAD,CAAjB;;AACA,MAAME,kBAAkB,GAAGH,OAAO,CAAC,uBAAD,CAAlC;;AACA,MAAMI,oBAAoB,GAAGJ,OAAO,CAAC,yBAAD,CAApC;;AAEA,MAAMK,UAAU,GAAG,IAAIN,GAAJ,CAAQ,SAAR,CAAnB;;AAEAO,MAAM,CAACC,OAAP,GAAkBC,KAAD,IAAW;AAC1B,SAAO;AACL;;;;;AAKA,UAAMC,MAAN,GAAgB;AAAE;AAChB,aAAOD,KAAK,CAACE,GAAN,CAAUL,UAAV,CAAP;AACD,KARI;;AASL;;;;;AAKA,UAAMM,GAAN,GAAa;AACX,YAAMC,GAAG,GAAG,MAAMJ,KAAK,CAACG,GAAN,CAAUN,UAAV,CAAlB;AACA,aAAOQ,QAAQ,CAACV,kBAAkB,CAACS,GAAD,CAAnB,EAA0B,EAA1B,CAAf;AACD,KAjBI;;AAkBL;;;;;;AAMA,UAAME,GAAN,CAAWC,OAAX,EAAoB;AAAE;AACpB,aAAOP,KAAK,CAACQ,GAAN,CAAUX,UAAV,EAAsBD,oBAAoB,CAACa,MAAM,CAACF,OAAD,CAAP,CAA1C,CAAP;AACD,KA1BI;;AA2BL;;;;;AAKA,UAAMG,KAAN,CAAaC,QAAb,EAAuB;AACrB,YAAMJ,OAAO,GAAG,MAAM,KAAKJ,GAAL,EAAtB;AACAT,MAAAA,GAAG,CAAC,8BAAD,EAAiCa,OAAjC,EAA0CI,QAA1C,CAAH,CAFqB,CAGrB;AACA;;AACA,YAAMC,iBAAiB,GAAIL,OAAO,KAAK,CAAZ,IAAiBI,QAAQ,KAAK,CAA/B,IAAsCA,QAAQ,KAAK,CAAb,IAAkBJ,OAAO,KAAK,CAA9F;AAEA,aAAOA,OAAO,KAAKI,QAAZ,IAAwBC,iBAA/B;AACD;;AAxCI,GAAP;AA0CD,CA3CD","sourcesContent":["'use strict'\n\nconst Key = require('interface-datastore').Key\nconst debug = require('debug')\nconst log = debug('ipfs:repo:version')\nconst uint8ArrayToString = require('uint8arrays/to-string')\nconst uint8ArrayFromString = require('uint8arrays/from-string')\n\nconst versionKey = new Key('version')\n\nmodule.exports = (store) => {\n  return {\n    /**\n     * Check if a version file exists.\n     *\n     * @returns {Promise<bool>}\n     */\n    async exists () { // eslint-disable-line require-await\n      return store.has(versionKey)\n    },\n    /**\n     * Get the current version.\n     *\n     * @returns {Promise<Integer>}\n     */\n    async get () {\n      const buf = await store.get(versionKey)\n      return parseInt(uint8ArrayToString(buf), 10)\n    },\n    /**\n     * Set the version of the repo, writing it to the underlying store.\n     *\n     * @param {number} version\n     * @returns {Promise<void>}\n     */\n    async set (version) { // eslint-disable-line require-await\n      return store.put(versionKey, uint8ArrayFromString(String(version)))\n    },\n    /**\n     * Check the current version, and returns true if versions matches\n     * @param {number} expected\n     * @returns {boolean}\n     */\n    async check (expected) {\n      const version = await this.get()\n      log('comparing version: %s and %s', version, expected)\n      // Version 6 and 7 are the same\n      // TODO: Clean up the compatibility logic. Repo feature detection would be ideal, or a better version schema\n      const compatibleVersion = (version === 6 && expected === 7) || (expected === 6 && version === 7)\n\n      return version === expected || compatibleVersion\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}